<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="responsive.css">
  <title>Membership â€” VMSNA</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>

<body>
  <header>
    <nav class="nav">
      <div class="brand" style="display: flex; align-items: center; gap: 12px;"><a href="index.html"
          style="display: flex; align-items: center;"><img src="assets/img/vokkaligasangam.png" alt="VMSNA Logo"
            style="height: 100px !important; width: auto; margin: -20px 0;"></a><span
          style="font-size: 18px; font-weight: 600; white-space: nowrap; margin-right: 32px;">Vokkaliga Mahajana Sangam
          North America</span>
      </div><button class="toggle" aria-label="Open menu">â˜°</button>
      <div class="menu">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="chapters.html">Chapters</a></li>
          <li><a href="events.html">Events</a></li>
          <li><a href="membership.html">Membership</a></li>
          <li><a href="donate.html">Donate</a></li>
          <li><a href="media.html">Media</a></li>
          <li><a href="help.html">Help</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>
    </nav>
  </header>
  <section class='section' style='max-width: 1200px; margin: 0 auto; padding: 48px 24px;'>
    <h2 class='h2'>Membership</h2>
    <p class='lead'>Join a vibrant network of families, professionals, and students.</p>
    <div class='grid cols-2' style='gap: 24px; margin-top: 32px;'>
      <div class='tile' style='background: #0a1a27; border: 1px solid #143244; border-radius: 12px; padding: 32px;'>
        <h3 style='color: #0ea5a4; font-size: 22px; margin-top: 0; margin-bottom: 20px;'>Membership Benefits</h3>
        <ul style='color: #cfe6f1; line-height: 2; padding-left: 20px; font-size: 16px; margin-bottom: 32px;'>
          <li>Access to member directory and mentorship network</li>
          <li>Discounts for events and convention</li>
          <li>Scholarships and youth programs</li>
          <li>Volunteer opportunities and leadership roles</li>
          <li>Community support (education, humanitarian)</li>
        </ul>
        <h3 style='color: #0ea5a4; font-size: 22px; margin-top: 0; margin-bottom: 20px;'>Become a Member</h3>
        <form id='join-form' style='display: flex; flex-direction: column; gap: 16px;'>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Full Name</label>
            <input name='name' required
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Native Place (Self)</label>
            <input name='origin_self' placeholder='e.g., Odaipatti, Theni District'
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Spouse Name</label>
            <input name='spouse_name'
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Native Place (Spouse)</label>
            <input name='origin_spouse' placeholder='e.g., Thadagam, Coimbatore District'
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Email</label>
            <input type='email' name='email' required
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Spouse Email</label>
            <input type='email' name='spouse_email' placeholder='spouse@example.com'
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Children Details</label>
            <textarea name='children_details' rows='3' placeholder='Names and ages of children'
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px; resize: vertical;'></textarea>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Street Address</label>
            <input name='street' placeholder='123 Main Street' required
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>City</label>
            <input name='city' placeholder='San Francisco' required
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; gap: 12px;'>
            <div style='display: flex; flex-direction: column; gap: 8px; flex: 1;'>
              <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>State</label>
              <input name='state' placeholder='CA' required
                style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
            </div>
            <div style='display: flex; flex-direction: column; gap: 8px; flex: 1;'>
              <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>ZIP Code</label>
              <input name='zip' placeholder='94102' required
                style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
            </div>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Phone</label>
            <input name='phone'
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Spouse Phone</label>
            <input name='spouse_phone' placeholder='+1 234 567 8900'
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Profession and Services Offered for
              Community</label>
            <input name='profession' placeholder='e.g., Pediatrician, Teach Dance, Event Planning'
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>LinkedIn/Business/Other URL (Multiple URLs
              separated by commas or spaces)</label>
            <input name='profile_url' type='text'
              placeholder='e.g., https://linkedin.com/in/yourname, https://mywebsite.com'
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Spouse Profession and Services Offered for
              Community</label>
            <input name='spouse_profession' placeholder='e.g., Software Engineer, Play Guitar, Photography'
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>LinkedIn/Business/Other URL
              (Spouse - Multiple URLs separated by commas or spaces)</label>
            <input name='spouse_profile_url' type='text'
              placeholder='e.g., https://linkedin.com/in/spousename, https://website.com'
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Password</label>
            <input type='password' name='password' required
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div
            style='background: #0d1f2d; border: 1px solid #1a3a4f; border-radius: 8px; padding: 20px; margin-top: 8px;'>
            <h4 style='color: #d9a441; font-size: 16px; margin-top: 0; margin-bottom: 12px;'>Directory Privacy Settings
            </h4>
            <p style='font-size: 13px; color: #98b3c2; margin-bottom: 16px;'>Choose what information other members can
              see in the member directory:</p>
            <div style='display: flex; flex-direction: column; gap: 12px;'>
              <label style='display: flex; align-items: center; cursor: pointer;'>
                <input type='radio' name='privacy' value='full' checked
                  style='margin-right: 10px; width: 18px; height: 18px; cursor: pointer;'>
                <span style='color: #cfe6f1; font-size: 15px;'><strong>Full Profile</strong> - Show all details (name,
                  location, profession, contact info)</span>
              </label>
              <label style='display: flex; align-items: center; cursor: pointer;'>
                <input type='radio' name='privacy' value='limited'
                  style='margin-right: 10px; width: 18px; height: 18px; cursor: pointer;'>
                <span style='color: #cfe6f1; font-size: 15px;'><strong>Limited Profile</strong> - Show only name and
                  state</span>
              </label>
            </div>
          </div>
          <button type='submit'
            style='background: #0ea5a4; color: #072025; border: none; border-radius: 8px; padding: 12px 20px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 8px;'>Submit
            Application</button>
        </form>
        <p class='lead' style='font-size: 13px; margin-top: 16px; color: #98b3c2;'>Your application will be stored
          securely in Firebase. Check your email for account verification.</p>
      </div>
      <div class='tile' style='background: #0a1a27; border: 1px solid #143244; border-radius: 12px; padding: 32px;'>
        <h3 style='color: #d9a441; font-size: 22px; margin-top: 0; margin-bottom: 20px;'>Member Login</h3>
        <form id='login-form' style='display: flex; flex-direction: column; gap: 16px;'>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Email</label>
            <input id='login-user' required
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; flex-direction: column; gap: 8px;'>
            <label style='color: #98b3c2; font-size: 14px; font-weight: 600;'>Password</label>
            <input id='login-pass' type='password' required
              style='background: #07111b; border: 1px solid #143244; border-radius: 8px; padding: 12px; color: #cfe6f1; font-size: 15px;'>
          </div>
          <div style='display: flex; gap: 12px;'>
            <button type='submit'
              style='background: #d9a441; color: #2b1803; border: none; border-radius: 8px; padding: 12px 20px; font-size: 16px; font-weight: 600; cursor: pointer; flex: 1;'>Login</button>
            <button type='button' id='logout'
              style='background: transparent; color: #d9a441; border: 1px solid #d9a441; border-radius: 8px; padding: 12px 20px; font-size: 16px; font-weight: 600; cursor: pointer; flex: 1;'>Logout</button>
          </div>
          <div style='text-align: center; margin-top: 12px;'>
            <a href='#' id='forgot-password-link'
              style='color: #0ea5a4; font-size: 14px; text-decoration: none; cursor: pointer;'>Forgot Password?</a>
            <span style='color: #98b3c2; margin: 0 8px;'>â€¢</span>
            <a href='#' id='resend-verification-link'
              style='color: #0ea5a4; font-size: 14px; text-decoration: none; cursor: pointer;'>Resend Verification
              Email</a>
          </div>
        </form>
        <p class='lead' style='font-size: 13px; margin-top: 16px; color: #98b3c2;'>Login with your email and password to
          access the member dashboard.</p>
      </div>
    </div>
    <footer>
      <div class="cols">
        <div><strong>VMSNA</strong><br>A volunteer-run, non-profit community platform.</div>
        <div>
          <h4>Explore</h4><a href="about.html">About</a><br><a href="chapters.html">Chapters</a>
        </div>
        <div>
          <h4>Members</h4><a href="membership.html">Benefits</a><br><a href="donate.html">Donate</a>
        </div>
        <div>
          <h4>Help</h4><a href="help.html">Welfare</a><br><a href="contact.html">Contact</a>
        </div>
      </div>
      <div class="copy">Â© <span id="year"></span> VMSNA. All rights reserved.</div>
      <script>document.getElementById("year").textContent = new Date().getFullYear();</script>
    </footer>
    <script>document.addEventListener('DOMContentLoaded', function () { const btn = document.querySelector('.nav .toggle'); const menu = document.querySelector('.nav .menu'); if (btn && menu) { btn.addEventListener('click', () => { const isOpen = menu.style.display === 'block'; menu.style.display = isOpen ? 'none' : 'block'; }); } });</script>
</body>

</html>
<script>
  // Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBtPNMDkpYpWDumVd5srmQR0RSJF9azdBA",
    authDomain: "vmsna-e9bd0.firebaseapp.com",
    projectId: "vmsna-e9bd0",
    storageBucket: "vmsna-e9bd0.firebasestorage.app",
    messagingSenderId: "863778654324",
    appId: "1:863778654324:web:0be4038e6383505f86a921",
    measurementId: "G-GW1V7MS84J"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  (function () {
    let currentUser = null;
    let isSigningUp = false;

    // Check authentication state
    auth.onAuthStateChanged(user => {
      currentUser = user;
      if (user && !isSigningUp) {
        // If user is already logged in, redirect to dashboard
        window.location.href = 'dashboard.html';
      }
    });

    // Join form submission
    document.getElementById('join-form').addEventListener('submit', async e => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = {
        name: formData.get('name'),
        nativePlaceSelf: formData.get('origin_self'),
        spouseName: formData.get('spouse_name'),
        nativePlaceSpouse: formData.get('origin_spouse'),
        email: formData.get('email'),
        spouseEmail: formData.get('spouse_email'),
        childrenDetails: formData.get('children_details'),
        street: formData.get('street'),
        city: formData.get('city'),
        state: formData.get('state'),
        zip: formData.get('zip'),
        phone: formData.get('phone'),
        spousePhone: formData.get('spouse_phone'),
        profession: formData.get('profession'),
        profileUrl: formData.get('profile_url'),
        spouseProfession: formData.get('spouse_profession'),
        spouseProfileUrl: formData.get('spouse_profile_url'),
        privacyLevel: formData.get('privacy'),
        submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
        status: 'pending'
      };

      const password = formData.get('password');

      try {
        isSigningUp = true;

        // Create user account
        const userCredential = await auth.createUserWithEmailAndPassword(data.email, password);

        // Send email verification
        await userCredential.user.sendEmailVerification();

        // Store membership application in Firestore
        await db.collection('membershipApplications').add({
          ...data,
          userId: userCredential.user.uid
        });

        alert('Your membership application has been submitted successfully!\n\nâš ï¸ IMPORTANT: A verification email has been sent to ' + data.email + '\n\nðŸ“§ FROM: Vokkaliga Mahajana Sangam North America\nðŸŒ Website: www.vmsna.org\n\nâœ“ This is a legitimate email from Vokkaliga Mahajana Sangam North America\nâœ“ Please check your SPAM/JUNK folder if you don\'t see it\nâœ“ Mark it as "Not Spam" to ensure future emails arrive in your inbox\n\nYou must verify your email before you can log in.');
        e.target.reset();

        // Sign out to prevent auto-redirect, user must log in
        await auth.signOut();
        isSigningUp = false;
      } catch (error) {
        console.error('Error submitting application:', error);
        if (error.code === 'auth/email-already-in-use') {
          alert('This email is already registered. Please use the login form.');
        } else if (error.code === 'auth/weak-password') {
          alert('Password should be at least 6 characters.');
        } else {
          alert('Error submitting application: ' + error.message);
        }
      }
    });

    // Check user's country location
    async function checkUserLocation() {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        const country = data.country_code; // Returns 2-letter country code like 'US', 'CA'

        console.log('User country:', country);

        if (country !== 'US' && country !== 'CA') {
          return false;
        }
        return true;
      } catch (error) {
        console.error('Error checking location:', error);
        // If geolocation check fails, allow login (fail open)
        return true;
      }
    }

    // Password reset handler
    document.getElementById('forgot-password-link').addEventListener('click', async e => {
      e.preventDefault();
      const email = document.getElementById('login-user').value.trim();

      if (!email) {
        alert('Please enter your email address in the Username field, then click "Forgot Password?"');
        return;
      }

      // Validate email format
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        alert('Please enter a valid email address.');
        return;
      }

      try {
        await auth.sendPasswordResetEmail(email);
        alert('âœ“ Password reset email sent!\n\nFROM: Vokkaliga Mahajana Sangam North America\nðŸŒ Website: www.vmsna.org\n\nâœ“ This is a legitimate email from Vokkaliga Mahajana Sangam North America\nâœ“ Please check your inbox and spam folder\nâœ“ The link will expire in 1 hour');
      } catch (error) {
        console.error('Error sending password reset email:', error);
        if (error.code === 'auth/user-not-found') {
          alert('No account found with this email address.');
        } else if (error.code === 'auth/invalid-email') {
          alert('Please enter a valid email address.');
        } else if (error.code === 'auth/too-many-requests') {
          alert('Too many password reset attempts. Please try again later.');
        } else {
          alert('Error sending password reset email. Please try again.');
        }
      }
    });

    // Resend verification email handler
    document.getElementById('resend-verification-link').addEventListener('click', async e => {
      e.preventDefault();
      const email = document.getElementById('login-user').value.trim();
      const password = document.getElementById('login-pass').value.trim();

      if (!email || !password) {
        alert('Please enter your email and password in the login fields, then click "Resend Verification Email".');
        return;
      }

      try {
        // Sign in to get the user object
        const userCredential = await auth.signInWithEmailAndPassword(email, password);

        // Check if already verified
        if (userCredential.user.emailVerified) {
          alert('âœ“ Your email is already verified!\n\nYou can now log in normally.');
          await auth.signOut();
          return;
        }

        // Send verification email
        await userCredential.user.sendEmailVerification();
        await auth.signOut();

        alert('âœ“ Verification email sent!\n\nFROM: Vokkaliga Mahajana Sangam North America\nðŸŒ Website: www.vmsna.org\n\nâœ“ This is a legitimate email from Vokkaliga Mahajana Sangam North America\nâœ“ Please check your inbox and spam folder\nâœ“ Mark as "Not Spam" if it appears in junk\n\nAfter verifying, you can log in.');
      } catch (error) {
        console.error('Error resending verification email:', error);
        if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
          alert('Invalid email or password. Please check your credentials.');
        } else if (error.code === 'auth/too-many-requests') {
          alert('Too many attempts. Please try again later.');
        } else {
          alert('Error sending verification email. Please try again.');
        }
      }
    });

    // Login form submission
    document.getElementById('login-form').addEventListener('submit', async e => {
      e.preventDefault();
      const username = document.getElementById('login-user').value.trim();
      const password = document.getElementById('login-pass').value.trim();

      try {
        // Check location first
        const isAllowedLocation = await checkUserLocation();
        if (!isAllowedLocation) {
          alert('Access is restricted to users in the United States and Canada only.');
          return;
        }

        const userCredential = await auth.signInWithEmailAndPassword(username, password);

        // Check if email is verified
        if (!userCredential.user.emailVerified) {
          await auth.signOut();
          alert('Please verify your email before logging in. Check your inbox for the verification link.');
          return;
        }

        // Redirect to dashboard on successful login
        window.location.href = 'dashboard.html';
      } catch (error) {
        console.error('Error logging in:', error);
        if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
          alert('Invalid username or password.');
        } else {
          alert('Error logging in: ' + error.message);
        }
      }
    });

    // Logout
    document.getElementById('logout').addEventListener('click', async () => {
      try {
        await auth.signOut();
        alert('Logged out successfully.');
      } catch (error) {
        console.error('Error logging out:', error);
      }
    });
  })();
</script>